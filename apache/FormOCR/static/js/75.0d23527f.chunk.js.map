{"version":3,"sources":["views/Administration/scriptBuilder/EditScript.js","../node_modules/@material-ui/icons/esm/Save.js","../node_modules/@material-ui/icons/esm/Cancel.js"],"names":["useStyles","makeStyles","theme","formControl","margin","spacing","marginLeft","minWidth","maxWidth","chips","display","flexWrap","chip","noLabel","marginTop","withStyles","withTheme","props","React","useState","scriptName","setScriptName","scriptVersion","setScriptVersion","scriptId","setScriptId","scriptSno","setScriptSno","JSON","parse","localStorage","getItem","domainId","roles","setRoles","setScript","scriptCode","setScriptCode","userRoles","setUserRoles","username","domainName","useEffect","roles_data","method","headers","fetch","USER_SERVICE","then","response","json","data","rolesFromApi","map","role","push","value","roleName","label","catch","error","console","log","match","params","script_data","body","stringify","id","SCRIPT_SERVICE","Promise","resolve","reject","text","length","err","script","script_code","selectedRoles","version","name","sno","adaptedRoles","xs","sm","noValidate","row","className","htmlFor","disabled","onChange","e","target","md","placeholder","options","isMulti","style","backgroundColor","padding","height","defaultLanguage","col","xl","block","variant","color","onClick","scriptRoles","history","createSvgIcon","d"],"mappings":"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","file":"static/js/75.0d23527f.chunk.js","sourcesContent":["\nimport React, {useEffect} from 'react'\nimport {\n  CButton,\n  CCard,\n  CCardBody,\n  CCardFooter,\n  CCardHeader,\n  CCol,\n  CFormGroup,\n  CInput, CSelect,\n  CLabel, CNavbar, CNavbarBrand, CRow, CForm, CInputGroup, CInvalidFeedback,\n} from '@coreui/react'\nimport CIcon from '@coreui/icons-react'\nimport { DocsLink } from 'src/reusable'\nimport { Link } from 'react-router-dom'\nimport {FormBuilder} from 'react-formio';\nimport {makeStyles, withStyles} from '@material-ui/core/styles';\n\nimport {Cancel, Save} from \"@material-ui/icons\";\nimport {Chip} from \"@material-ui/core\";\nimport Select from 'react-select';\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport Input from \"@material-ui/core/Input\";\nimport {SERVER_URL, USER_SERVICE, SCRIPT_SERVICE} from \"../../../constants\";\nimport Editor from \"@monaco-editor/react\";\nconst useStyles = makeStyles((theme) => ({\n  formControl: {\n    margin: theme.spacing(1),\n    marginLeft: 0+'px !important',\n    minWidth: 220,\n    maxWidth: 300,\n  },\n  chips: {\n    display: 'flex',\n    flexWrap: 'wrap',\n  },\n  chip: {\n    margin: 2,\n  },\n  noLabel: {\n    marginTop: theme.spacing(3),\n  },\n}));\nconst ITEM_HEIGHT = 48;\nconst ITEM_PADDING_TOP = 8;\nconst MenuProps = {\n  PaperProps: {\n    style: {\n      maxHeight: ITEM_HEIGHT * 4.5 + ITEM_PADDING_TOP,\n      width: 250,\n    },\n  },\n};\n\nconst EditScript = (props) => {\n   const [collapsed, setCollapsed] = React.useState(true)\n    const [showElements, setShowElements] = React.useState(true)\n    const [scriptName, setScriptName] = React.useState('');\n    const [alert, setAlert] = React.useState('');\n    const [scriptVersion, setScriptVersion] = React.useState('');\n    const [display, setDisplay] = React.useState('');\n    const [scriptId, setScriptId] = React.useState('');\n    const [scriptSno, setScriptSno] = React.useState('');\n    const [type, setType] = React.useState('script');\n    const [domainId, setDomainId] = React.useState(JSON.parse(localStorage.getItem('domain_data')).domainId);\n    const [roles, setRoles] = React.useState([]);\n    const [script, setScript] = React.useState(null);\n    const [scriptCode, setScriptCode] = React.useState(null);\n    const [userRoles, setUserRoles] = React.useState([]);\n    const [businessObject, setBusinessObject] = React.useState(null);\n    const classes = useStyles();\n    const [username, setUsername] = React.useState(localStorage.getItem('username'));\n    const [domainName, setDomainName] = React.useState(JSON.parse(localStorage.getItem('domain_data')).domainName);\n\n\n  useEffect(()=> {\n      const roles_data = {\n          method: 'GET',\n          headers: {\n              \"X-Tenant\": domainName,\n              'Content-Type': 'application/json',\n              \"Authorization\": \"Bearer \" + localStorage.getItem(\"Authorization\")\n          }\n      };\n    fetch(USER_SERVICE + \"/api/auth/role/getRoles\", roles_data)\n      .then((response) => {\n        return response.json();\n      })\n      .then(data => {\n        var rolesFromApi = [];\n\n        data.map(role => {\n          rolesFromApi.push({\n              value : role.roleName,\n              label : role.roleName\n          })})\n        setUserRoles(rolesFromApi);\n\n      }).catch(error => {\n      console.log(error);\n    });\n\n\n      // const data = canvas._rootElement.businessObject;\n      // console.log(data);\n\n    const  scriptId = props.match.params.scriptId;\n    setScriptId(scriptId);\n    const script_data = {\n      method: 'POST',\n      headers: {\n          \"X-Tenant\": domainName,\n          'Content-Type': 'application/json',\n          \"Authorization\": \"Bearer \" + localStorage.getItem(\"Authorization\")},\n      body: JSON.stringify({id : scriptId})\n    };\n    fetch(SCRIPT_SERVICE + '/api/script/getByScriptId',script_data)\n      .then(response => {\n        return new Promise((resolve, reject) => {\n          response.text().then(body => {\n            resolve(\n              body.length ? JSON.parse(body) : null\n            );\n          }).catch(err => {\n            reject(err);\n          });\n        });\n      })\n      .then(data => {\n\n        setScript(JSON.parse(data.script))\n        setScriptCode(data.script_code)\n     //   console.log(JSON.parse(data.workflow).workflowRoles)\n        const selectedRoles = JSON.parse(data.roles);\n        setScriptVersion(JSON.parse(data.script).version);\n        setScriptName(JSON.parse(data.script).name);\n        setScriptSno(JSON.parse(data.script).sno);\n        var adaptedRoles = [];\n        selectedRoles.map(role => {\n          adaptedRoles.push({label: role.roleName, value:  role.roleName})\n        })\n        setRoles(adaptedRoles);\n      //  console.log(workflowRoles)\n      })\n      .catch(error => {\n        console.log(error);\n      });\n  },[]);\n\n\n\n  const handleInputChange  =(event) =>  {\n    console.log(event.target.value);\n  }\n\n  const handleChangeMultiple =(event)=> {\n    const {options} = event.target;\n    const value = [];\n    for (let i = 0, l = options.length; i < l; i += 1) {\n      if (options[i].selected) {\n        value.push(options[i].value);\n      }\n    }\n    setRoles(value);\n  }\n\n const handleSubmit = () =>  {\n     // const err= null\n     var data = {\n     scriptId: scriptId,\n       scriptName: scriptName,\n       scriptVersion: scriptVersion, scriptRoles: roles,\n       script: scriptCode,\n       domainId: domainId,\n       username: username\n     };\n       // log the current xml content to the browser console\n       //data.script = script;\n       const script_data = {\n         method: 'POST',\n         headers: {\n             \"X-Tenant\": domainName,\n             'Content-Type': 'application/json',\n           \"Authorization\": \"Bearer \"+localStorage.getItem('Authorization')},\n         body: JSON.stringify(data)\n       };\n       fetch(SCRIPT_SERVICE + '/api/script/edit', script_data)\n           .then(response => {\n             return new Promise((resolve, reject) => {\n               response.text().then(body => {\n                 resolve(\n                     body.length ? JSON.parse(body) : null\n                 );\n               }).catch(err => {\n                 reject(err);\n               });\n             });\n           })\n           .then(data => {\n            // const scriptId = data.scriptId\n             props.history.push(\"/admin/script/list\");\n           })\n   }\n\n  const hideAlert = () => {\n    setAlert(null)\n  };\n\n  const verifyLength = (value, length) => {\n    if (value.length >= length) {\n      return true;\n    }\n    return false;\n  };\n  const basicAlert = () =>{\n    /* this.setState({alert:\n         <SweetAlert\n           style={{ display: \"block\", marginTop: \"-100px\" }}\n           title=\"the form code is already used !\"\n           onConfirm={() => this.hideAlert()}\n           onCancel={() => this.hideAlert()}\n         />\n     })*/\n  };\n\n  const handleDelete = (chipToDelete) =>{\n    console.log(chipToDelete);\n    console.log(roles);\n    console.log(roles.filter((chip) => chip !== chipToDelete))\n    const data = roles.filter((chip) => chip !== chipToDelete);\n    setRoles(data);\n\n  };\n  let icon;\n\n    return (\n      <>\n        <CCol xs=\"12\" sm=\"12\">\n          <CCard>\n            <CCardHeader>\n              <h2>Modifier le script</h2>\n            </CCardHeader>\n            <CCardBody>\n              <CForm  noValidate >\n                <CFormGroup row className=\"my-0\">\n                  <CCol xs=\"6\">\n                    <CFormGroup>\n                      <CLabel htmlFor=\"scriptSno\">S No</CLabel>\n                      <CInput id=\"scriptSno\" value={scriptSno} disabled/>\n                    </CFormGroup>\n                  </CCol>\n                  <CCol xs=\"6\">\n                    <CFormGroup>\n                      <CLabel htmlFor=\"scriptName\">Nom du script</CLabel>\n                      <CInput id=\"scriptName\" onChange={e => setScriptName(e.target.value) }\n                              value={scriptName}  />\n                    </CFormGroup>\n                  </CCol>\n\n                </CFormGroup>\n                <CFormGroup row className=\"my-0\">\n                  <CCol xs=\"6\">\n                    <CFormGroup>\n                      <CLabel htmlFor=\"scriptVersion\">Version</CLabel>\n                      <CInput id=\"scriptVersion\" onChange={e => setScriptVersion(e.target.value) }\n                              value={scriptVersion} />\n                    </CFormGroup>\n                  </CCol>\n                  <CCol sm={12} md={6}>\n                        <CFormGroup>\n                            <CLabel htmlFor=\"AccessControlUser\">Contrôle d'accès</CLabel>\n\n                            <Select\n                              name=\"form-field-name2\"\n                              placeholder=\"Global\"\n                              value={roles}\n                              options={userRoles}\n                              onChange={setRoles}\n                              isMulti\n                            />\n                      </CFormGroup>\n                    </CCol>\n\n                </CFormGroup>\n                <CCard>\n                <CCardHeader style={{backgroundColor:\"#F5F5F5\"}}>\n                    Script\n                </CCardHeader>\n                    <CCardBody style={{padding:\"0px\"}}>\n\n                      <Editor\n                          height=\"70vh\"\n                          defaultLanguage=\"java\"\n                          value={scriptCode}\n                          onChange= {(value, e ) => setScriptCode(value)}\n                        />\n                  </CCardBody>\n                </CCard>\n                 <CRow xs=\"4\">\n\n              <CCol col=\"6\" sm=\"4\" md=\"2\" xl className=\"mb-3 mb-xl-0\">\n                <CButton block variant=\"outline\" color=\"info\" id=\"workflowSave\" onClick={handleSubmit}><Save/> Enregister</CButton>\n              </CCol>\n              <CCol col=\"6\" sm=\"4\" md=\"2\" xl className=\"mb-3 mb-xl-0\">\n                <CButton block variant=\"outline\" color=\"danger\"\n                         onClick={()=> props.history.push(\"/admin/script/list\")}><Cancel />\n                                                                                                         Annuler</CButton>\n              </CCol>\n              </CRow>\n              </CForm>\n            </CCardBody>\n          </CCard>\n        </CCol>\n      </>\n    )\n  }\nexport default withStyles({ ...useStyles}, { withTheme: true })(EditScript) ;\n\n","import * as React from 'react';\nimport createSvgIcon from './utils/createSvgIcon';\nexport default createSvgIcon( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z\"\n}), 'Save');","import * as React from 'react';\nimport createSvgIcon from './utils/createSvgIcon';\nexport default createSvgIcon( /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z\"\n}), 'Cancel');"],"sourceRoot":""}