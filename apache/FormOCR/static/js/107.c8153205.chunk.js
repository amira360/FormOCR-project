(this["webpackJsonpisct-group"]=this["webpackJsonpisct-group"]||[]).push([[107],{3047:function(e,t,a){"use strict";a.r(t);var n=a(39),o=a(13),c=a(680),l=a(89),i=a(1),s=a.n(i),r=a(733),u=(a(667),a(633)),d=a(658),f=a(115),j=(a(1481),a(3025)),h=a(701),b=(a(685),a(686),a(687),a(688),a(697)),p=a(704),m=a(679),O=(a(895),Object(j.a)((function(e){return{formControl:{margin:e.spacing(1),marginLeft:"0px !important",minWidth:220,maxWidth:300},chips:{display:"flex",flexWrap:"wrap"},chip:{margin:2},noLabel:{marginTop:e.spacing(3)}}})));t.default=Object(h.a)(Object(n.a)({},O),{withTheme:!0})((function(e){var t=Object(i.useRef)(null),a=s.a.useState(!0),n=Object(l.a)(a,2),j=(n[0],n[1],s.a.useState(!0)),h=Object(l.a)(j,2),S=(h[0],h[1],s.a.useState("")),g=Object(l.a)(S,2),w=(g[0],g[1],s.a.useState("")),x=Object(l.a)(w,2),k=(x[0],x[1],s.a.useState("")),y=Object(l.a)(k,2),v=(y[0],y[1],s.a.useState("")),I=Object(l.a)(v,2),T=(I[0],I[1],s.a.useState([])),N=Object(l.a)(T,2),A=(N[0],N[1]),C=s.a.useState(null),J=Object(l.a)(C,2),M=(J[0],J[1],s.a.useState("workflow")),z=Object(l.a)(M,2),B=(z[0],z[1],s.a.useState("")),P=Object(l.a)(B,2),W=(P[0],P[1],s.a.useState("")),F=Object(l.a)(W,2),K=(F[0],F[1],s.a.useState(JSON.parse(localStorage.getItem("domain_data")).domainId)),X=Object(l.a)(K,2),q=X[0],E=(X[1],s.a.useState([])),H=Object(l.a)(E,2),_=(H[0],H[1],s.a.useState([])),D=Object(l.a)(_,2),G=(D[0],D[1],s.a.useState([])),L=Object(l.a)(G,2),R=(L[0],L[1]),V=s.a.useState([]),Q=Object(l.a)(V,2),U=(Q[0],Q[1],s.a.useState([])),Y=Object(l.a)(U,2),Z=(Y[0],Y[1],s.a.useState("")),$=Object(l.a)(Z,2),ee=($[0],$[1],s.a.useState("")),te=Object(l.a)(ee,2),ae=(te[0],te[1],s.a.useState([])),ne=Object(l.a)(ae,2),oe=(ne[0],ne[1],s.a.useState([])),ce=Object(l.a)(oe,2),le=(ce[0],ce[1],s.a.useState(null)),ie=Object(l.a)(le,2),se=(ie[0],ie[1],O(),s.a.useState(null)),re=Object(l.a)(se,2),ue=(re[0],re[1],s.a.useState(null)),de=Object(l.a)(ue,2),fe=(de[0],de[1],s.a.useState(localStorage.getItem("username"))),je=Object(l.a)(fe,2),he=(je[0],je[1],s.a.useState("")),be=Object(l.a)(he,2),pe=(be[0],be[1],s.a.useState("")),me=Object(l.a)(pe,2),Oe=(me[0],me[1],s.a.useState("")),Se=Object(l.a)(Oe,2),ge=(Se[0],Se[1],s.a.useState([])),we=Object(l.a)(ge,2),xe=(we[0],we[1],s.a.useState([])),ke=Object(l.a)(xe,2),ye=ke[0],ve=ke[1],Ie=s.a.useState([]),Te=Object(l.a)(Ie,2),Ne=Te[0],Ae=Te[1],Ce=s.a.useState([]),Je=Object(l.a)(Ce,2),Me=(Je[0],Je[1],s.a.useState("")),ze=Object(l.a)(Me,2),Be=(ze[0],ze[1],s.a.useState("")),Pe=Object(l.a)(Be,2),We=(Pe[0],Pe[1],s.a.useState("")),Fe=Object(l.a)(We,2),Ke=(Fe[0],Fe[1],s.a.useState("")),Xe=Object(l.a)(Ke,2),qe=(Xe[0],Xe[1],s.a.useState("")),Ee=Object(l.a)(qe,2),He=(Ee[0],Ee[1],s.a.useState("")),_e=Object(l.a)(He,2),De=(_e[0],_e[1],s.a.useState([])),Ge=Object(l.a)(De,2),Le=Ge[0],Re=Ge[1],Ve=s.a.useState([{value:"somme",label:"Somme"},{value:"compte",label:"Compte"}]),Qe=Object(l.a)(Ve,2),Ue=(Qe[0],Qe[1],s.a.useState(!1)),Ye=Object(l.a)(Ue,2),Ze=(Ye[0],Ye[1],s.a.useState([{workflow:"",step:"",fields:""}])),$e=Object(l.a)(Ze,2),et=$e[0],tt=$e[1],at=s.a.useState(JSON.parse(localStorage.getItem("domain_data")).domainName),nt=Object(l.a)(at,2),ot=nt[0];nt[1];Object(i.useEffect)((function(){var e={method:"POST",headers:{"X-Tenant":ot,"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("Authorization")},body:JSON.stringify({workflowMasterId:localStorage.getItem("workflowMasterId")})};fetch(f.w+"/api/workflowMaster/getWorkflowByWorkfowMasterId",e).then((function(e){return new Promise((function(t,a){e.text().then((function(e){t(e.length?JSON.parse(e):null)})).catch((function(e){a(e)}))}))})).then((function(e){var t=[];t.push({value:e.id,label:e.name}),ve(t)}));var t={method:"GET",headers:{"X-Tenant":ot,"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("Authorization")}};fetch(f.v+"/api/auth/role/getRoles",t).then((function(e){return e.json()})).then((function(e){var t=[];e.map((function(e){t.push({value:e.roleName,label:e.roleName})})),R(t)})).catch((function(e){console.log(e)}));var a={method:"POST",headers:{"X-Tenant":ot,"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("Authorization")},body:JSON.stringify({domainId:q})};fetch(f.x+"/api/workflow/getAll",a).then((function(e){return new Promise((function(t,a){e.text().then((function(e){t(e.length?JSON.parse(e):null)})).catch((function(e){a(e)}))}))})).then((function(e){var t=[];null!==e&&(e.map((function(e){t.push({value:e.id,label:e.name+"-"+e.version})})),A(t))}))}),[]);var ct=function e(t,a,n){var o=[];return t.map((function(t,a){"object"===typeof t.components?"datagrid"!==t.type?o.push({label:t.title,id:t.id,fieldKey:t.key,children:e(t.components,!0,0)}):t.components.map((function(t,a){"object"===typeof t.components?o.push({label:t.label,id:t.id,fieldKey:t.key,children:e(t.components,!0,0)}):"object"===typeof t.columns?t.columns.map((function(e){"object"===typeof e.components&&e.components.map((function(e,t){o.push({label:e.label,id:e.id,fieldKey:e.key})}))})):o.push({label:t.label,id:t.id,fieldKey:t.key})})):"object"===typeof t.columns?t.columns.map((function(e){"object"===typeof e.components&&e.components.map((function(e,t){o.push({label:e.label,id:e.id,fieldKey:e.key})}))})):o.push({label:t.label,id:t.id,fieldKey:t.key})})),o},lt=function(e){localStorage.setItem("selectedWorkflowId",e);var t={method:"POST",headers:{"X-Tenant":ot,"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("Authorization")},body:JSON.stringify({workflowId:e})};fetch(f.w+"/api/workflowMaster/getStepsByWorkflowId",t).then((function(e){return new Promise((function(t,a){e.text().then((function(e){t(e.length?JSON.parse(e):null)})).catch((function(e){a(e)}))}))})).then((function(e){Ae(e)}))},it=function(e,t){var a={method:"POST",headers:{"X-Tenant":ot,"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("Authorization")},body:JSON.stringify({taskId:t,workflowId:e})};fetch(f.w+"/api/workflowMaster/getFormsByTaskId",a).then((function(e){return new Promise((function(t,a){e.text().then((function(e){t(e.length?JSON.parse(e):null)})).catch((function(e){a(e)}))}))})).then((function(e){console.log(e);var t=[];e.map((function(e){t.push.apply(t,Object(c.a)(e))})),console.log(t);var a=[];t.map((function(e){a.push(e.value)})),console.log(a);var n=Array.from(new Set(a)),o=[];n.map((function(e){o.push({formCode:e})})),console.log(o),function(e){var t={method:"POST",headers:{"X-Tenant":ot,"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("Authorization")},body:JSON.stringify({formCodes:e})};fetch(f.g+"/api/form/getByFormCodes",t).then((function(e){return new Promise((function(t,a){e.text().then((function(e){console.log(e),t(e.length?JSON.parse(e):null)})).catch((function(e){a(e)}))}))})).then((function(e){console.log(e);var t=JSON.parse(e.forms_json),a=[],n=[];t.map((function(e){var t=ct(e.components);console.log(t),t.map((function(e){e.children&&e.children.length&&(e.children.map((function(e){n.push({label:e.label,value:e.fieldKey})})),a.push.apply(a,n))})),Re([].concat(a))}))})).catch((function(e){console.log(e)}))}(o)}))};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(r.Toast,{ref:t}),Object(o.jsx)(u.k,{xs:"12",sm:"12",children:Object(o.jsxs)(u.f,{children:[Object(o.jsx)(u.j,{children:Object(o.jsx)("h2",{children:"Maitre de workflow | Param\xe9trage de notification"})}),Object(o.jsx)(u.g,{children:Object(o.jsxs)(u.u,{noValidate:!0,children:[Object(o.jsx)(u.f,{children:Object(o.jsxs)(u.g,{children:[et.map((function(e,t){return Object(o.jsx)("div",{style:{marginTop:"10px"},children:Object(o.jsx)("div",{style:{width:"100%",borderBottom:"1px solid lightGray"},children:Object(o.jsxs)(u.v,{row:!0,className:"my-0",children:[Object(o.jsx)(u.k,{sm:12,md:3,children:Object(o.jsxs)(u.v,{children:[Object(o.jsx)(u.H,{htmlFor:"workflow",children:"Workflow"}),Object(o.jsx)(m.a,{name:"workflow",value:e.workflow,onChange:function(e){return function(e,t){var a=Object(c.a)(et);a[e].workflow=t,tt(a),lt(t.value)}(t,e)},options:ye,required:!0})]})}),Object(o.jsx)(u.k,{sm:12,md:3,children:Object(o.jsxs)(u.v,{children:[Object(o.jsx)(u.H,{htmlFor:"step",children:"Step"}),Object(o.jsx)(m.a,{name:"step",value:e.step,onChange:function(e){return function(e,t){var a=Object(c.a)(et);a[e].step=t,tt(a),it(localStorage.getItem("selectedWorkflowId"),t.value)}(t,e)},options:Ne,required:!0})]})}),Object(o.jsx)(u.k,{sm:12,md:3,children:Object(o.jsxs)(u.v,{children:[Object(o.jsx)(u.H,{htmlFor:"fields",children:"Fields"}),Object(o.jsx)(m.a,{name:"fields",value:e.fields,onChange:function(e){return function(e,t){var a=Object(c.a)(et);a[e].fields=t,tt(a)}(t,e)},options:Le,isMulti:!0,required:!0})]})}),Object(o.jsx)(u.k,{sm:12,md:1,style:{paddingTop:"50px"},children:t?Object(o.jsx)(u.k,{sm:12,md:12,children:Object(o.jsx)(d.Button,{onClick:function(e){return function(e,t){e.preventDefault();var a=Object(c.a)(et);a.splice(t,1),tt(a)}(e,t)},icon:"pi pi-trash",className:"p-button-rounded p-button-danger"})}):null})]})})},t)})),Object(o.jsx)(u.k,{sm:12,md:6,children:Object(o.jsx)("div",{className:"button-section",children:Object(o.jsx)("button",{className:"button add",type:"button",onClick:function(){tt([].concat(Object(c.a)(et),[{workflow:"",step:"",fields:""}]))},children:"Add"})})})]})}),Object(o.jsxs)(u.O,{xs:"4",children:[Object(o.jsx)(u.k,{col:"6",sm:"4",md:"2",xl:!0,className:"mb-3 mb-xl-0",children:Object(o.jsxs)(u.e,{block:!0,variant:"outline",color:"info",id:"workflowSave",onClick:function(t){t.preventDefault();var a=[];et.map((function(e){""!==e.fields&&a.push(e)}));var n={method:"POST",headers:{"X-Tenant":ot,"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("Authorization")},body:JSON.stringify({domainId:q,workflowMasterId:localStorage.getItem("workflowMasterId"),workflowValues:a})};""!==et[0].step&&""!==et[0].fields?fetch(f.w+"/api/workflowMaster/notification/saveNotificationSettings",n).then((function(e){return new Promise((function(t,a){e.text().then((function(e){t(e.length?JSON.parse(e):null)})).catch((function(e){a(e)}))}))})).then((function(t){localStorage.setItem("workflowMasterAdded",localStorage.getItem("workflowMasterId")),e.history.push("/admin/workflowMaster/list"),window.location.reload()})):(e.history.push("/admin/workflowMaster/list"),window.location.reload())},children:[Object(o.jsx)(b.a,{})," Enregister"]})}),Object(o.jsx)(u.k,{col:"6",sm:"4",md:"2",xl:!0,className:"mb-3 mb-xl-0",children:Object(o.jsxs)(u.e,{block:!0,variant:"outline",color:"danger",children:[Object(o.jsx)(p.a,{}),"Annuler"]})})]})]})})]})})]})}))}}]);
//# sourceMappingURL=107.c8153205.chunk.js.map