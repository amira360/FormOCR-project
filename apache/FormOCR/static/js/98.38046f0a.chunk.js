(this["webpackJsonpisct-group"]=this["webpackJsonpisct-group"]||[]).push([[98],{3118:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return Z}));var s=a(13),n=a(39),o=a(169),i=a(33),r=a.n(i),c=a(680),l=a(52),d=a(695),h=a(696),u=a(922),m=a(700),b=a(699),j=a(1),f=a.n(j),p=a(1210),O=a.n(p),x=a(637),v=a.n(x),y=a(89),g=a(738),S=a(3025),w=a(3048),k=a(3050),N=a(933),I=a.n(N),C=a(2682),T=a(722),M=a(930),A=(a(1078),a(1079)),P=a(1080),J=a(1081),B=a(1082),F=a(1083),W=a(1084),L=a(115);function _(){var e=Object(g.a)(["\n  flex: 1 1 0;\n  display: flex;\n  flex-direction: column;\n\n  .text-container {\n    min-height: 50px;\n\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border: solid 2px black;\n    .text {\n      font-size: 30px;\n    }\n  }\n\n  "," {\n    flex: 1;\n  }\n   "," {\n      flex: 1;\n    }\n     "," {\n        flex: 1;\n      }\n       "," {\n          flex: 1;\n        }\n         "," {\n            flex: 1;\n          }\n           "," {\n              flex: 1;\n            }\n             "," {\n                flex: 1;\n              }\n"]);return _=function(){return e},e}function z(){var e=Object(g.a)(["\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n"]);return z=function(){return e},e}var R=Object(S.a)({root:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},header:{display:"flex",alignItems:"center",padding:"0.5rem"},spacer:{flexGrow:1},body:{padding:"0.5rem",flexGrow:1}}),E=T.a.div(z()),H=T.a.div(_(),M.a,J.a,W.a,F.a,P.a,B.a,A.a);function D(e){var t,a=e.id,n=e.type,o=e.title,i=e.onRemoveItem,r=(e.component,e.workflowMaster),c=e.kpi,l=Object(j.useState)(300),d=Object(y.a)(l,2),h=(d[0],d[1],Object(j.useState)(200)),u=Object(y.a)(h,2),m=u[0],b=(u[1],Object(j.useState)([])),f=Object(y.a)(b,2),p=f[0],O=f[1],x=Object(j.useState)(JSON.parse(localStorage.getItem("domain_data")).domainName),v=Object(y.a)(x,2),g=v[0],S=(v[1],R());return Object(j.useEffect)((function(){if(null!==c&&void 0!==c){var e="",t="";e="string"===typeof c?c:c.value,t="string"===typeof r?r:r.value;var a={method:"POST",headers:{"X-Tenant":g,"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("Authorization")},body:JSON.stringify({workflowMasterId:t,domainName:g,kpiId:e})};fetch(L.j+"/api/indicator/getById",a).then((function(e){return new Promise((function(t,a){e.text().then((function(e){t(e.length?JSON.parse(e):null)})).catch((function(e){a(e)}))}))})).then((function(e){console.log(e);var t=[];e.map((function(e){t.push({data:[e.y],name:new Date(e.x).getMonth()+1+"-"+new Date(e.x).getFullYear()})})),O(t)}))}}),[]),"Line"===n?t=Object(s.jsx)(J.b,{data:p,workflowMasterName:r.label}):"Bar"===n?t=Object(s.jsx)(P.b,{data:p,workflowMasterName:r.label}):"Spline"===n?t=Object(s.jsx)(B.b,{data:p,workflowMasterName:r.label}):"Column"===n?t=Object(s.jsx)(W.b,{data:p,workflowMasterName:r.label}):"Pie"===n?t=Object(s.jsx)(F.b,{data:p,workflowMasterName:r.label}):"Variwide"===n&&(t=Object(s.jsx)(A.b,{data:p,workflowMasterName:r.label})),Object(s.jsxs)(w.a,{className:S.root,children:[Object(s.jsxs)("div",{className:S.header,style:{backgroundColor:"#E4E6E8",height:"40px"},children:[Object(s.jsx)(C.a,{variant:"h6",gutterBottom:!0,children:o}),Object(s.jsx)("div",{className:S.spacer}),Object(s.jsx)(k.a,{"aria-label":"delete",onClick:function(){return i(a)},children:Object(s.jsx)(I.a,{fontSize:"small"})})]}),Object(s.jsx)("div",{className:S.body,children:Object(s.jsx)(E,{children:Object(s.jsx)(H,{height:m,children:t})})})]},a)}a(1496);var U=a(658),G=a(743),V=a(697),X=a(704),K=a(679),Y=a(689),q=(a(685),a(686),a(687),a(688),a(633)),Q=Object(p.WidthProvider)(O.a),Z=function(e){Object(m.a)(a,e);var t=Object(b.a)(a);function a(e){var s;return Object(d.a)(this,a),(s=t.call(this,e)).menu=f.a.createRef(),s.onLayoutChange=s.onLayoutChange.bind(Object(u.a)(s)),s.selectWorklfowMaster=s.selectWorklfowMaster.bind(Object(u.a)(s)),s.handleFormSubmit=s.handleFormSubmit.bind(Object(u.a)(s)),s.state={visibleDashboard:!1,orders:[],layout:[],items:[],initialLoad:!0,newCounter:0,workflowMaster:"",titles:[],title:"",performanceIndicators:[],selectedPerformanceIndicator:{},chartTypes:[{value:"Line",label:"Ligne"},{value:"Bar",label:"Bar"},{value:"Variwide",label:"Vari\xe9"},{value:"Column",label:"Colonne"},{value:"Spline",label:"Spline"},{value:"Pie",label:"Pie"}],dashboardName:"",dashboardId:e.match.params.dashboardId,roles:[],grid:[],admin:[],selectedUsers:[],users:[],userRoles:[],selectedType:"",workflowMasters:[],selectedWorkflowMaster:{},selectedTypes:[],selectedWorkflowMasters:[],selectedPerformanceIndicators:[],domainId:JSON.parse(localStorage.getItem("domain_data")).domainId,domainName:JSON.parse(localStorage.getItem("domain_data")).domainName,position:"center"},s}return Object(h.a)(a,[{key:"componentDidMount",value:function(){var e=Object(l.a)(r.a.mark((function e(){var t,a,s,n,o,i,l=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=JSON.parse(localStorage.getItem("domain_data")).domainId,a=JSON.parse(localStorage.getItem("domain_data")).domainName,s={method:"POST",headers:{"X-Tenant":a,"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("Authorization")},body:JSON.stringify({dashboardId:this.state.dashboardId})},n=[],o=[],i=[],e.next=8,fetch(L.c+"/api/dashboard/getById",s).then((function(e){return new Promise((function(t,a){e.text().then((function(e){t(e.length?JSON.parse(e):null)})).catch((function(e){a(e)}))}))})).then((function(e){var s=JSON.parse(e.dashboard);console.log(s),l.setState({dashboardName:s.name});var r=s.dashboardGridItems;n=JSON.parse(e.access_role),o=JSON.parse(e.admin_access),i=JSON.parse(e.user_access),console.log(n),console.log(o),console.log(i);var d=[],h=[],u=[],m=[],b=[],j=[],f=Object(c.a)(r);f.sort((function(e,t){return e.orders-t.orders}));var p=[];l.setState({grid:f}),f.map((function(e){p.push(e.orders),d.push(e.title),h.push({label:e.chartType,value:e.chartType}),u.push({label:e.workflowMasterName,value:e.workflowMasterId}),m.push({value:e.performanceIndicatorId,label:e.performanceIndicatorName}),j.push({x:e.x,y:e.y,w:e.w,i:e.i,h:e.h}),b.push({static:e.staticLayout,x:e.xLayout,y:e.yLayout,w:e.wLayout,i:e.iLayout,h:e.hLayout})})),l.setState({orders:p}),l.setState({layout:b}),l.setState({titles:[].concat(d)}),l.setState({selectedTypes:[].concat(h)}),l.setState({selectedWorkflowMasters:[].concat(u)}),l.setState({selectedPerformanceIndicators:[].concat(m)}),l.setState({newCounter:l.state.newCounter}),l.setState({items:j}),l.setState({visibleDashboard:!0});var O={method:"POST",headers:{"X-Tenant":a,"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("Authorization")},body:JSON.stringify({domainId:t})};fetch(L.w+"/api/workflowMaster/getAll",O).then((function(e){return new Promise((function(t,a){e.text().then((function(e){t(e.length?JSON.parse(e):null)})).catch((function(e){a(e)}))}))})).then((function(e){console.log(e);var t=[];e.map((function(e){t.push({value:e.id,label:e.name})})),l.setState({worklfowMasters:t})})),fetch(L.v+"/api/auth/role/getRoles").then((function(e){return e.json()})).then((function(e){var t=[];e.map((function(e){t.push({value:e.roleName,label:e.roleName})}));var a=[];n.map((function(t){var s=e.filter((function(e){return e.roleId===t.roleId}));a.push({value:s[0].roleName,label:s[0].roleName})})),l.setState({roles:a});var s=[];o.map((function(t){var a=e.filter((function(e){return e.roleId===t.roleId}));s.push({value:a[0].roleName,label:a[0].roleName})})),l.setState({admin:s}),l.setState({userRoles:t})})).catch((function(e){console.log(e)}))}));case 8:fetch(L.v+"/api/auth/user/getUsersByDomain/"+t).then((function(e){return new Promise((function(t,a){e.text().then((function(e){t(e.length?JSON.parse(e):null)})).catch((function(e){a(e)}))}))})).then((function(e){var t,a=[];e.map((function(e){a.push({value:e.userId,label:e.firstName+" "+e.lastName})}));var s=[];null===(t=i)||void 0===t||t.map((function(t){var a=e.filter((function(e){return e.userId===t.userId}));s.push({value:a[0].userId,label:a[0].firstName+" "+a[0].lastName})})),l.setState({selectedUsers:s}),l.setState({users:a})})),this.onClick=this.onClick.bind(this),this.onAddItem=this.onAddItem.bind(this),this.onBreakpointChange=this.onBreakpointChange.bind(this),this.items=[{label:"Ajouter un chart",icon:"pi pi-plus",command:function(){l.onClick("displayMaximizable")}}];case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onClick",value:function(e,t){var a=Object(o.a)({},"".concat(e),!0);t&&(a=Object(n.a)(Object(n.a)({},a),{},{position:t})),this.setState(a)}},{key:"onHide",value:function(e){console.log(this.state.selectedType),this.setState(Object(o.a)({},"".concat(e),!1))}},{key:"onSubmit",value:function(e){console.log(this.state.selectedType),this.onAddItem(),this.setState(Object(o.a)({},"".concat(e),!1))}},{key:"renderFooter",value:function(e){var t=this;return Object(s.jsxs)("div",{children:[Object(s.jsx)(U.Button,{label:"Soumettre",icon:"pi pi-check",onClick:function(){return t.onSubmit(e)},autoFocus:!0}),Object(s.jsx)(U.Button,{label:"Annuler",icon:"pi pi-times",onClick:function(){return t.onHide(e)},className:"p-button-text"})]})}},{key:"createElement",value:function(e,t){var a=this,n=(e.i,"");console.log(t),console.log(this.state.orders);var o=this.state.orders[t];if(void 0!==this.state.selectedTypes[o]){n="string"===typeof this.state.selectedTypes[o]?this.state.selectedTypes[o]:this.state.selectedTypes[o].value;var i=this.state.titles[o],r=this.state.selectedWorkflowMasters[o],c=this.state.selectedPerformanceIndicators[o];if(null!==c)return Object(s.jsx)("div",{"data-grid":e,children:Object(s.jsx)(D,{id:o+"",workflowMaster:r,kpi:c,type:n,title:i,onRemoveItem:function(e){a.onRemoveItem(e)}})},o+"")}}},{key:"onAddItem",value:function(){this.setState({items:this.state.items.concat({i:""+this.state.newCounter,x:2*this.state.items.length%(this.state.cols||12),y:1/0,w:2,h:2}),titles:[].concat(Object(c.a)(this.state.titles),[this.state.title]),selectedTypes:[].concat(Object(c.a)(this.state.selectedTypes),[this.state.selectedType]),selectedWorkflowMasters:[].concat(Object(c.a)(this.state.selectedWorkflowMasters),[this.state.selectedWorkflowMaster]),selectedPerformanceIndicators:[].concat(Object(c.a)(this.state.selectedPerformanceIndicators),[this.state.selectedPerformanceIndicator]),newCounter:this.state.newCounter+1})}},{key:"onBreakpointChange",value:function(e,t){this.setState({breakpoint:e,cols:t})}},{key:"onRemoveItem",value:function(e){console.log("removing",e),this.setState({items:v.a.reject(this.state.items,{i:e})})}},{key:"onLayoutChange",value:function(e){console.log(e);this.state.items,Object(c.a)(this.state.titles),Object(c.a)(this.state.selectedTypes),this.state.newCounter;$("items",this.state.items),$("titles",Object(c.a)(this.state.titles)),$("selectedTypes",Object(c.a)(this.state.selectedTypes)),$("selectedWorkflowMasters",Object(c.a)(this.state.selectedWorkflowMasters)),$("selectedPerformanceIndicators",Object(c.a)(this.state.selectedPerformanceIndicators)),$("newCounter",this.state.newCounter),$("layout",e),this.setState({layout:e})}},{key:"selectWorklfowMaster",value:function(e){var t=this;this.setState({selectedWorkflowMaster:e});var a={method:"POST",headers:{"X-Tenant":this.state.domainName,"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("Authorization")},body:JSON.stringify({workflowMasterId:e.value})};fetch(L.j+"/api/indicator/getAll",a).then((function(e){return new Promise((function(t,a){e.text().then((function(e){t(e.length?JSON.parse(e):null)})).catch((function(e){a(e)}))}))})).then((function(e){console.log(e);var a=[];e.map((function(e){a.push({value:e.id,label:e.indicator})})),t.setState({performanceIndicators:a})}))}},{key:"handleFormSubmit",value:function(e){var t=this,a=[];this.state.layout.map((function(e){a.push({h:e.h,i:e.i,static:e.static,w:e.w,x:e.x,y:e.y})}));var s={titles:this.state.titles,selectedTypes:this.state.selectedTypes,selectedWorkflowMasters:this.state.selectedWorkflowMasters,selectedPerformanceIndicators:this.state.selectedPerformanceIndicators,items:this.state.items,layout:a},n={dashboardId:this.state.dashboardId,domainName:this.state.domainName,dashboardName:this.state.dashboardName,controlAccessRoles:this.state.roles,controlAccessAdmin:this.state.admin,controlAccessUsers:this.state.selectedUsers,gridItems:s},o={method:"POST",headers:{"X-Tenant":this.state.domainName,"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("Authorization")},body:JSON.stringify(n)};fetch(L.c+"/api/dashboard/edit",o).then((function(e){return new Promise((function(t,a){e.text().then((function(e){t(e.length?JSON.parse(e):null)})).catch((function(e){a(e)}))}))})).then((function(e){t.props.history.push("/admin/dashboard/list")}))}},{key:"render",value:function(){var e=this,t=this.state.visibleDashboard;return Object(s.jsx)(q.k,{xs:"12",sm:"12",children:Object(s.jsxs)(q.f,{children:[Object(s.jsx)(q.j,{children:Object(s.jsx)("h2",{children:"Cr\xe9er un Tableau de bord"})}),Object(s.jsx)(q.g,{children:Object(s.jsxs)(q.u,{noValidate:!0,children:[Object(s.jsxs)(q.v,{row:!0,className:"my-0",children:[Object(s.jsx)(q.k,{sm:12,md:6,children:Object(s.jsxs)(q.v,{children:[Object(s.jsx)(q.H,{htmlFor:"dashboardName",children:"Nom du Tableau de bord"}),Object(s.jsx)(q.A,{id:"dashboardName",onChange:function(t){return e.setState({dashboardName:t.target.value})},value:this.state.dashboardName})]})}),Object(s.jsx)(q.k,{sm:12,md:6,children:Object(s.jsxs)(q.v,{children:[Object(s.jsx)(q.H,{htmlFor:"AccessControlRoles",children:"Contr\xf4le d'acc\xe8s (R\xf4les)"}),Object(s.jsx)(K.a,{name:"AccessControlRoles",placeholder:"Global",value:this.state.roles,options:this.state.userRoles,onChange:function(t){return e.setState({roles:t})},isMulti:!0})]})})]}),Object(s.jsxs)(q.v,{row:!0,className:"my-0",children:[Object(s.jsx)(q.k,{sm:12,md:6,children:Object(s.jsxs)(q.v,{children:[Object(s.jsx)(q.H,{htmlFor:"AccessControlAdmin",children:"Contr\xf4le d'acc\xe8s (Admin)"}),Object(s.jsx)(K.a,{name:"AccessControlAdmin",placeholder:"Global",value:this.state.admin,options:this.state.userRoles,onChange:function(t){return e.setState({admin:t})},isMulti:!0})]})}),Object(s.jsx)(q.k,{sm:12,md:6,children:Object(s.jsxs)(q.v,{children:[Object(s.jsx)(q.H,{htmlFor:"AccessControlUser",children:"Contr\xf4le d'acc\xe8s (User)"}),Object(s.jsx)(K.a,{name:"AccessControlUser",placeholder:"Global",value:this.state.selectedUsers,options:this.state.users,onChange:function(t){return e.setState({selectedUsers:t})},isMulti:!0})]})})]}),Object(s.jsxs)(q.f,{children:[Object(s.jsxs)(q.j,{style:{backgroundColor:"#F5F5F5"},children:["Tableau de Bord",Object(s.jsx)(Y.Menu,{model:this.items,popup:!0,ref:function(t){return e.menu=t},id:"popup_menu"}),Object(s.jsx)(q.I,{style:{paddingLeft:"10px"},className:"card-header-actions",children:Object(s.jsx)("i",{size:"2xl",className:"pi pi-bars",icon:"pi pi-bars",onClick:function(t){return e.menu.toggle(t)},"aria-controls":"popup_menu","aria-haspopup":!0})})]}),Object(s.jsx)(q.g,{children:Object(s.jsx)("div",{children:t&&Object(s.jsx)(Q,{layout:this.state.layout,onLayoutChange:this.onLayoutChange,onBreakpointChange:this.onBreakpointChange,children:this.state.items.map((function(t,a){return e.createElement(t,a)}))})})}),Object(s.jsx)(G.Dialog,{visible:this.state.displayMaximizable,maximizable:!0,modal:!0,style:{width:"70vw"},footer:this.renderFooter("displayMaximizable"),onHide:function(){return e.onHide("displayMaximizable")},children:Object(s.jsxs)(q.u,{noValidate:!0,children:[Object(s.jsxs)(q.v,{row:!0,className:"my-0",children:[Object(s.jsx)(q.k,{sm:12,md:12,children:Object(s.jsxs)(q.v,{children:[Object(s.jsx)(q.H,{htmlFor:"title",children:"Titre"}),Object(s.jsx)(q.A,{id:"title",onChange:function(t){return e.setState({title:t.target.value})},value:this.state.title})]})}),Object(s.jsx)(q.k,{sm:12,md:12,children:Object(s.jsxs)(q.v,{children:[Object(s.jsx)(q.H,{htmlFor:"chartType",children:"Type de chart"}),Object(s.jsx)(K.a,{name:"chartType",value:this.state.selectedType,options:this.state.chartTypes,onChange:function(t){return e.setState({selectedType:t})}})]})})]}),Object(s.jsxs)(q.v,{row:!0,className:"my-0",children:[Object(s.jsx)(q.k,{sm:12,md:12,children:Object(s.jsxs)(q.v,{children:[Object(s.jsx)(q.H,{htmlFor:"workfowMaster",children:"Ma\xeetre de flux de travail"}),Object(s.jsx)(K.a,{name:"workfowMaster",value:this.state.selectedWorkflowMaster,options:this.state.worklfowMasters,onChange:function(t){return e.selectWorklfowMaster(t)}})]})}),Object(s.jsx)(q.k,{sm:12,md:12,children:Object(s.jsxs)(q.v,{children:[Object(s.jsx)(q.H,{htmlFor:"indicator",children:"Indicateur"}),Object(s.jsx)(K.a,{name:"indicator",value:this.state.selectedPerformanceIndicator,options:this.state.performanceIndicators,onChange:function(t){return e.setState({selectedPerformanceIndicator:t})}})]})})]})]})})]}),Object(s.jsxs)(q.O,{xs:"4",children:[Object(s.jsx)(q.k,{col:"6",sm:"4",md:"2",xl:!0,className:"mb-3 mb-xl-0",children:Object(s.jsxs)(q.e,{block:!0,variant:"outline",color:"info",id:"formSave",onClick:function(t){return e.handleFormSubmit(t)},children:[Object(s.jsx)(V.a,{})," Enregister"]})}),Object(s.jsx)(q.k,{col:"6",sm:"4",md:"2",xl:!0,className:"mb-3 mb-xl-0",children:Object(s.jsxs)(q.e,{block:!0,variant:"outline",color:"danger",onClick:function(){return e.props.history.push("/admin/dashboard/list")},children:[Object(s.jsx)(X.a,{})," Annuler"]})})]})]})})]})})}}]),a}(f.a.PureComponent);function $(e,t){localStorage&&localStorage.setItem(e,JSON.stringify(Object(o.a)({},e,t)))}Z.defaultProps={className:"layout",onLayoutChange:function(){}},!0===Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).STATIC_EXAMPLES&&a.e(22).then(a.bind(null,3105)).then((function(e){return e.default(Z)}))}}]);
//# sourceMappingURL=98.38046f0a.chunk.js.map