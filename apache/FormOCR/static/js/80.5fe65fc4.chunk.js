(this["webpackJsonpisct-group"]=this["webpackJsonpisct-group"]||[]).push([[80],{3034:function(e,t,n){"use strict";n.r(t);var a=n(13),c=n(89),o=n(1),s=n.n(o),r=n(167),i=n(385),l=n(633),u=n(639),d=n(115),h=n(836),m=n(837);t.default=function(e){var t=s.a.useState(""),n=Object(c.a)(t,2),j=n[0],p=n[1],f=s.a.useState(""),b=Object(c.a)(f,2),O=b[0],g=b[1],x=s.a.useState(""),S=Object(c.a)(x,2),v=S[0],y=S[1],N=s.a.useState(""),k=Object(c.a)(N,2),w=k[0],I=k[1],T=s.a.useState(""),C=Object(c.a)(T,2),J=C[0],A=C[1],P=s.a.useState(""),z=Object(c.a)(P,2),_=z[0],X=z[1],B=s.a.useState(!1),E=Object(c.a)(B,2),G=(E[0],E[1]),U=s.a.useState(JSON.parse(localStorage.getItem("domain_data")).domainName),D=Object(c.a)(U,2),R=D[0];D[1];Object(o.useEffect)((function(){null===localStorage.getItem("domain_data")&&e.history.push("/domain")}),[]);var F=function(t){if(t.preventDefault(),""===O&&g("error"),""===w&&I("error"),"success"===O&&"success"===w){d.u;var n=JSON.parse(localStorage.getItem("domain_data"));null===n&&e.history.push("/domain");n.domainId;var a={method:"POST",headers:{"X-Tenant":R,"Content-Type":"application/json"},body:JSON.stringify({username:j,password:v,domainId:n.domainId})};fetch(d.e+"/api/auth/verifUserDomain",a).then((function(e){return new Promise((function(t,n){e.text().then((function(e){t(e.length?JSON.parse(e):null)})).catch((function(e){n(e)}))}))})).then((function(t){if(null===t)X("error"),A("Username or password is invalid !");else{var n={method:"POST",headers:{"X-Tenant":R,"Content-Type":"application/json"},body:JSON.stringify({username:j,password:v})};fetch(d.a+"/api/auth/authenticate",n).then((function(e){return new Promise((function(t,n){e.text().then((function(e){t(e.length?JSON.parse(e):null)})).catch((function(e){n(e)}))}))})).then((function(t){var n=localStorage.getItem("device_token");if(null!==n){var a={method:"POST",headers:{"X-Tenant":R,"Content-Type":"application/json",Authorization:"Bearer "+t.token},body:JSON.stringify({device_token:n,username:j})};fetch(d.v+"/api/token/verifyDeviceToken",a).then((function(e){return new Promise((function(t,n){e.text().then((function(e){t(e.length?JSON.parse(e):null)})).catch((function(e){n(e)}))}))}))}localStorage.setItem("token",t.token),localStorage.setItem("refreshToken",t.refreshToken),localStorage.setItem("Authorization",t.token),localStorage.setItem("username",j),localStorage.setItem("password",v),G(!0);var c={method:"GET",headers:{"X-Tenant":R,"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("Authorization")}};fetch(d.v+"/api/auth/role/getRolesByUsername/"+j,c).then((function(e){return new Promise((function(t,n){e.text().then((function(e){t(e.length?JSON.parse(e):null)})).catch((function(e){n(e)}))}))})).then((function(e){localStorage.setItem("userRoles",e.roles),localStorage.setItem("userPermissions",e.permissions)})).catch((function(e){console.log(e)}));var o={method:"POST",headers:{"X-Tenant":R,"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("Authorization")},body:JSON.stringify({domainId:JSON.parse(localStorage.getItem("domain_data")).domainId})};fetch(d.x+"/api/workflow/getAll",o).then((function(e){return new Promise((function(t,n){e.text().then((function(e){t(e.length?JSON.parse(e):null)})).catch((function(e){n(e)}))}))})).then((function(e){localStorage.setItem("workflows",JSON.stringify(e))})).catch((function(e){console.log(e)})),e.history.push("/dashboard")})).catch((function(e){console.log(e),X("error"),A("Username or password is invalid !")}))}})).catch((function(e){console.log(e)}))}},M=function(e,t){return e.length>=t};return Object(a.jsx)(i.a.Consumer,{children:function(e){e.setAuthenticated,e.setSnack;return Object(a.jsx)("div",{className:"c-app c-default-layout flex-row align-items-center",children:Object(a.jsx)(l.l,{children:Object(a.jsx)(l.O,{className:"justify-content-center",children:Object(a.jsx)(l.k,{md:"12",children:Object(a.jsxs)(l.i,{children:[Object(a.jsx)(l.f,{className:"text-white py-4 col-md-5 order-md-2",style:{background:" linear-gradient(rgba(0, 0, 255, 0.0), rgba(0, 0, 255, 0.0)), url(".concat(h.a,")")},children:Object(a.jsxs)(l.g,{className:"text-center",children:[Object(a.jsx)("img",{src:m.a,width:"150px",style:{borderRadius:"0px"}}),Object(a.jsx)("div",{style:{marginTop:"100px"},children:Object(a.jsx)(r.b,{to:"/domain",children:Object(a.jsx)(l.e,{color:"primary",shape:"pill",className:"mt-3",active:!0,tabIndex:-1,children:"Changer le domaine"})})})]})}),Object(a.jsx)(l.f,{className:"p-4 col-md-7 order-md-1",children:Object(a.jsx)(l.g,{children:Object(a.jsxs)(l.u,{onSubmit:F,method:"post",children:[Object(a.jsx)("h1",{children:"Connexion"}),Object(a.jsx)("p",{className:"text-muted",children:"Connectez-vous \xe0 votre compte"}),Object(a.jsxs)(l.C,{className:"mb-3",children:[Object(a.jsx)(l.A,{type:"hidden",invalid:"error"===_}),Object(a.jsx)(l.G,{className:"help-block",children:J})]}),Object(a.jsxs)(l.C,{className:"mb-3",children:[Object(a.jsx)(l.E,{children:Object(a.jsx)(l.F,{children:Object(a.jsx)(u.a,{name:"cil-user"})})}),Object(a.jsx)(l.A,{type:"text",invalid:"error"===O,onChange:function(e){p(e.target.value),M(e.target.value,1)?g("success"):g("error")},placeholder:"Nom d'utilisateur",autoComplete:"username"}),Object(a.jsx)(l.G,{className:"help-block",children:"Nom d'utilisateur est n\xe9cessaire"})]}),Object(a.jsxs)(l.C,{className:"mb-4",children:[Object(a.jsx)(l.E,{children:Object(a.jsx)(l.F,{children:Object(a.jsx)(u.a,{name:"cil-lock-locked"})})}),Object(a.jsx)(l.A,{type:"password",placeholder:"Mot de passe",invalid:"error"===w,onChange:function(e){y(e.target.value),M(e.target.value,1)?I("success"):I("error")},autoComplete:"current-password"}),Object(a.jsx)(l.G,{className:"help-block",children:"Mot de passe requis"})]}),Object(a.jsx)(l.O,{children:Object(a.jsx)(l.k,{xs:"6",children:Object(a.jsxs)(l.e,{type:"submit",color:"primary",shape:"pill",className:"px-4",children:[Object(a.jsx)("i",{className:"pi pi-sign-in",children:" "})," \xa0Connexion"]})})})]})})})]})})})})})}})}},836:function(e,t,n){"use strict";t.a=n.p+"static/media/bg.608704a5.jpg"},837:function(e,t,n){"use strict";t.a=n.p+"static/media/icon.cfaf8cec.gif"}}]);
//# sourceMappingURL=80.5fe65fc4.chunk.js.map